<div class="content-wrapper">

  <section class="content">

    <div class="container">
      <div class="col-xs-12">
        <div class="box">
          <div class="row">
            <div class="col-xs-12">
              <div class="box">
                <div class="box-header with-border">
                  <h3 class="box-title">All Users</h3>
                </div>
                <!-- /.box-header -->
                <form class="form-horizontal">
                  <div class="box-body">
                    <table class="table table-hover">
                      <tbody>
                      <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Date</th>
                        <th></th>
                      </tr>
                      <% @user.each do |item| -%>
                        <tr>
                          <td> <%= item.id %></td>
                          <td> <%= item.name %></td>
                          <td> <%= item.email %></td>
                          <input  id="roles<%= item.id %>" type="hidden" value="<%= item.role %>">
                          <% if item.role == 'admin' %>
                            <td><span class="label label-success"><%= item.role %></span></td>
                          <% else %>
                            <td><span class="label label-warning"><%= item.role %></span></td>
                          <% end %>
                          <td><%= item.created_at %></td>
                          <td>
                            <button title="Click to remove" id="button_remove_user" class="btn btn-default btn-danger" value="<%= item.id %>">
                              <i class="fa fa-remove"></i>Remove
                            </button>
                            <button title="Click to change role" id="button_role_user" class="btn btn-default btn-success" value="<%= item.id %>">
                              <i class="fa fa-edit"></i>Change role
                            </button>
                          </td>
                        </tr>
                      <% end -%>
                      </tbody>
                    </table>
                  </div>
                  <!-- /.box-body -->
                </form>
                <!-- /.box-body -->
              </div>
              <!-- /.box -->
            </div>
          </div>
          <!-- /.box-body -->
        </div>
        <!-- /.box -->
      </div>
      <%= will_paginate @user %>

    </div>
  </section>
</div>

<script>
    jQuery(document).ready(function () {
        $('button#button_remove_user').click(function () {
            var user_id = $(this).val();
            var self = this;
            if (confirm('Are you sure you want to delete this user?')) {
                $.ajax({
                    url: '/remove_uri',
                    method: 'GET',
                    data: {
                        id: user_id
                    },
                    dataType: 'Json',
                    success: function () {
                        $(self).parent().parent().hide('slow', function () {
                            $(self).parent().parent().remove();
                        });
                    },
                    error: function () {
                        alert("Delete Error!");
                        $(self).parent().parent().hide('slow', function () {
                            $(self).parent().parent().remove();
                        });
                    }

                });
            }
        });

        $('button#button_role_user').click(function () {
            var user_id = $(this).val();
            var role =  document.getElementById("roles"+user_id).value;

            console.log('role', role)
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            if (confirm('Are you sure you want to change role of this user?')) {
                $.ajax({
                    url: '/change_role',
                    type: 'GET',
                    data: {
                        user_id: user_id,
                        role: role
                    },
                    contentType: "application/x-www-form-urlencoded",
                    success: function () {
                        window.location.reload();
                    },
                    error: function () {
                        alert("Change role failed!");
                    }
                });
            }
        });
    })
</script>